parameters:
  - name: buildConfig
    displayName: Build Configuration to Use
    default: Debug
    values:
    - Debug
    - Release

trigger:
- master

pool:
  vmImage: 'windows-latest'

variables:
- name: buildConfiguration
  value: ${{ parameters.buildConfig }}

steps:
- checkout: self

- task: UseDotNet@2
  displayName: Setup .NET SDK Version 9.x
  inputs:
    packageType: sdk
    version: 9.x
    includePreviewVersions: true

- task: DotNetCoreCLI@2
  displayName: 'Build the Assembly'
  inputs:
    command: build
    versioningScheme: byBuildNumber
    arguments: '--configuration $(BuildConfiguration)'
    projects: $(Build.SourcesDirectory)/Windows/exe/AzFilesSmbMIClient.csproj

- task: onebranch.pipeline.launchtools@1  # https://aka.ms/obpipelines/corext
  displayName: 'CoreXT prebuild'
  env:
    COREXT_ARTIFACTTOOL_PAT_HANDOFF: $(CDP_DEFAULT_CLIENT_PACKAGE_PAT)
  retryCountOnTaskFailure: 3
  inputs:
    command: 'prebuild'
    single_leg: false

- task: onebranch.pipeline.signing@1
  displayName: 'Sign NuGet Package Binaries'
  inputs:
    command: 'sign'
    signing_profile: 'external_distribution' # https://eng.ms/docs/products/onebranch/signing/containerbuildsigning#signing_profile
    files_to_sign: '**/*.exe,**/*.dll'
    search_root: '$(Build.SourcesDirectory)\bin\release\net472'